# Notes on PACT contract testing

## Pact

- Pact is an contract testing tool that further improves the contract testing workflow by allowing users to implement consumer-driven contracts.

During the consumer tests, each request made to a Pact mock provider is recorded into the contract file, along with its expected response.
[In FE we have already the mock in place, we do not want to duplicate with Pact]

https://pactflow.io/how-pact-works/#slide-1

## Bi-Directional Contract Testing (BDCT)

Bi-Directional Contract Testing is a type of static contract testing where two contracts - one representing the consumer expectations, and another representing the provider capability - are compared to ensure they are compatible.
The comparisons is based on their schema.

BDCT is a feature exclusive to PactFlow and is not available in the Pact OSS project (it is a paid solution).

- Contract first provider driven workflows
- Using OpenAPI
- Integration with MSQ, Cypress, Wiremock
- Support contract verification Postman, Dredd
- For white/black box
- Wide audience contract tester dev, qas, SDET (Software Development Engineer in Test)

https://docs.pactflow.io/docs/bi-directional-contract-testing/?&utm_source=bdct-lander&utm_campaign=bdct-go-live&utm_content=how-it-works

Pact is a record and replay style contract using specification by example to prove correctness.
Bi-Directional Contract Testing instead using a schema comparison approach.

Packflow provides continuous api compliance by comparison the consumer contract with the provider contract such as an API contract.
It allows to generate of contracts from existing mocks (such as wiremock). 
Developers can use their plug-and-play adapter.
This is good because you can leverage existing tools.

Pros:
- Low barrier to entry
- Scale faster, reuse existing tests
- Upscale re-using current processed and tolling

## How it works

### Consumer side

- Consumer tests behaviour against a mock (write a test that checks our consumer behavior against a mock), we could use wiremock or MSW in this part
- From the mock used to test the consumer (MSW mocks), we use it to generate to contract (pact file, aka the consumer contract)
- Test consumer and provider independently

### Provider side

- We start with a provider contract (for instance open API spec, generated by hand or from code)
- We do provider testing, make sure the provider code base is compatible with that open API spec (verify provider contract)

The end result we have 2 contracts, one what the consumer needs and another what provider can do.

Both contracts are uploaded on Pactflow, the consumer and provider have separated pipelines.

After a contract comparison is made, to make sure their consumer is a valid subset of the provider contract (schema comparison).

## Steps

## Consumer

- The consumer tests its behavior against a mock such Wiremock or Pact (Pact will generate its own Pact file)
- Consumer contract is produced in the form of pact file, there only the interaction with the consumer is captured
- Consumer contract is uploaded to Pactflow
- We check the compatibility with the provider

## Provider

- The provider starts with its own specification (OpenAPI), this is the provider contract (can be generated by hand or by code), if OpenAPI is generated by code we can skip the next point
- The provider contract is tested against the provider using a funcional API testing tool such RestAssured, Dredd, or Postman
- Provider contract i uploaded to Pactflow
- We check the compatibility with the consumer


## Notes:

With BDCT, the key difference is that a Provider uploads its own provider contract advertising its full capacity which is statically compared to the expectations in the consumer contract - the consumer contract is never replayed against the provider code base. This creates a much simpler and decoupled workflow. See the trade-offs for more.

## Remember:

- Contract tests focus on the messages that flow between a consumer and provider (schema)
- Functional tests also ensure that the correct side effects have occurred (for instance a new entry is created in db)
- A consumer contract is a collection of interactions that describe how the Consumer expects the Provider to behave. Each Consumer will have its own unique consumer contract for each of its Providers.
- A provider contract specifies the capability of the Provider. In this workshop, it will take the form of an OpenAPI document, but may be other formats such as a GraphQL schema, a SOAP XSD, a protobuf definition and so on.

https://pactflow.io/difference-between-consumer-driven-contract-testing-and-bi-directional-contract-testing/
