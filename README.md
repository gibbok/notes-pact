# Notes on PACT contract testing


## Bi-Directional Contract Testing (BDCT)

Bi-Directional Contract Testing is a type of static contract testing where two contracts - one representing the consumer expectations, and another representing the provider capability - are compared to ensure they are compatible.
The compairons is based on their schema.

BDCT is a feature exclusive to PactFlow and is not available in the Pact OSS project (it is a payed solution).

- Contract first provider drivern workflows
- Using OpenAPI
- Integration with MSQ, CYpress, Wiremock
- Suppot contract verification Postman, Dredd
- For white/black box
- Wide audiance contract tester dev, qas, SDET (Software Development Engineer in Test)

https://docs.pactflow.io/docs/bi-directional-contract-testing/?&utm_source=bdct-lander&utm_campaign=bdct-go-live&utm_content=how-it-works


Pact is a record and replay style contract using specification by example to prove correctness.
Bi-Directional Contract Testing instead using a schema comparison approch.

Packflow provide continuose api compliance by comparisni the consumer contract with the provider contract such an API contract.
It allow to generate contract from existing mocks (such as wiremock). 
Developer can use their plug and play adapter.
This is good because you can leverage existing tools.

Pros:
- Low barrier to entry
- Scale faster, reuse existing tets
- Upacale re-using current processed and tolling

## How it works

### Consumer side

- Consumer tetss behaviour against mock (write test that check our consumer behaviour against a mock), we could use wiremock or MSW in this part
- From the mock used to test the consumer (MSW mocks), we use it to generate to contract (pact file, aka the consumer contract)
- Test consumer and provider indipendently

### Provider side

- We start with a provider contract (for instance a open api spec, generated by hand or from code)
- We do provider testing, make sure the provider code base is compatble with that open api spec (verify provider contract)

The end result we have 2 contract, what the consumer needs and another whata provider can do
Both contract are uploaded on Pactflow, consumer and provider have seperate pipelines.
After a contract comparison is made, to make sure there consumer is a valid subset of the provider contract (schema comparison).

## Steps

## Consumer
- The consumer tests its behaviour against a mock such Wiremock or Pact (Pact will generate it own Pact file)
- Consumer contract is produced in the form of pact file, there only the interaction with the consumer is captured
- Consumer contract is uploaded to Pactflow
- We check the compatibility with the provider

## Provider
- The provider start with its own specification (OpenAPI), this is the provider contrat (can be generated by hand or by code), if OpenAPI is generated by code we can skip next point
- The provider contract is tested against the provider using a funcional API testin tool such RestAssured, Dredd or Postman
- Provider contrat i uploaded to Pactflow
- We check the compatibility with the consumer


Notes:

With BDCT, the key difference is that a Provider uploads its own provider contract advertising its full capability which is statically compared to the expectations in the consumer contract - the consumer contract is never replayed against the provider code base. This creates a much simpler and decoupled workflow. See the trade-offs for more.

Remember:
- Contract tests focus on the messages that flow between a consumer and provider (schema)
- Functional tests also ensure that the correct side effects have occurred (for instance a new entry is created in db)


A consumer contract is a collection of interactions which describe how the Consumer expects the Provider to behave. Each Consumer will have its own unique consumer contract for each of its Providers.

A provider contract specifies the capability of the Provider. In this workshop, it will take the form of an OpenAPI document, but may be other formats such as a GraphQL schema, a SOAP XSD, a protobuf definition and so on.
